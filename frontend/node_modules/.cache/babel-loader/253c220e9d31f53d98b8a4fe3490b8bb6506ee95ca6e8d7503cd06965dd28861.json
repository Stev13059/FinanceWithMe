{"ast":null,"code":"import \"core-js/modules/esnext.iterator.map.js\";\nimport { message } from 'ant-design-vue';\n\n// Request config\nconst defaultOptions = {\n  headers: {\n    'Content-Type': 'application/json;charset=utf-8'\n  },\n  baseURL: 'https://financewithme.azurewebsites.net/api',\n  code: 'WePrywqwpoUEGrZA0UTEUvfqibt8H0QmOhBDmHzVbySFAzFu4V2R3w=='\n};\n\n// error interception \nconst errorHandler = error => {\n  if (error.response) {\n    message.error(error.response.statusText || 'The server is busy, please try again later.');\n  }\n  if (error.statusText) {\n    message.error(error.statusText || 'The server is busy, please try again later.');\n  }\n  return Promise.reject(error);\n};\nconst requestInterceptor = config => {\n  const newConfig = {\n    ...config\n  };\n  newConfig.url = `${defaultOptions.baseURL}${config.url}`;\n  if (newConfig.url.indexOf('/user/login') == -1 && newConfig.url.indexOf('/user/register') == -1) {\n    const userId = localStorage.getItem('userId');\n    if (userId) {\n      config.params ? Object.assign(config.params, {\n        'userId': userId\n      }) : config.params = {\n        'userId': userId\n      };\n    }\n  }\n  if (config.params) {\n    if (config.method.toUpperCase() === 'GET') {\n      newConfig.url = `${newConfig.url}?${Object.keys(config.params).map(m => `${m}=${config.params[m]}`).join('&')}`;\n    } else if (config.method.toUpperCase() === 'POST') {\n      newConfig.body = JSON.stringify(config.params);\n    }\n    delete newConfig.params;\n  }\n  newConfig.url = newConfig.url.indexOf('?') > -1 ? `${newConfig.url}&code=${defaultOptions.code}` : `${newConfig.url}?code=${defaultOptions.code}`;\n  return newConfig;\n};\nexport const request = async (url, options = {}) => {\n  const config = requestInterceptor({\n    ...defaultOptions,\n    ...options,\n    url\n  });\n  const response = await fetch(config.url, {\n    ...config\n  });\n  if (response.ok) {\n    const data = await response.json();\n    if (data.result || data.code == 0) {\n      return Promise.resolve(data);\n    }\n    message.error(data.msg || 'error');\n    return Promise.reject();\n  }\n  return await errorHandler(response);\n};","map":{"version":3,"names":["message","defaultOptions","headers","baseURL","code","errorHandler","error","response","statusText","Promise","reject","requestInterceptor","config","newConfig","url","indexOf","userId","localStorage","getItem","params","Object","assign","method","toUpperCase","keys","map","m","join","body","JSON","stringify","request","options","fetch","ok","data","json","result","resolve","msg"],"sources":["C:/Users/gitCode/FinanceWithMe/frontend/src/utils/request.js"],"sourcesContent":["import { message } from 'ant-design-vue'\r\n\r\n// Request config\r\nconst defaultOptions = {\r\n  headers: { 'Content-Type': 'application/json;charset=utf-8' },\r\n  baseURL: 'https://financewithme.azurewebsites.net/api',\r\n  code: 'WePrywqwpoUEGrZA0UTEUvfqibt8H0QmOhBDmHzVbySFAzFu4V2R3w=='\r\n};\r\n\r\n// error interception \r\nconst errorHandler = (error) => {\r\n  if (error.response) {\r\n    message.error(error.response.statusText || 'The server is busy, please try again later.');\r\n  }\r\n  if (error.statusText) {\r\n    message.error(error.statusText || 'The server is busy, please try again later.');\r\n  }\r\n  return Promise.reject(error);\r\n};\r\n\r\nconst requestInterceptor = (config) => {\r\n  const newConfig = { ...config };\r\n  newConfig.url = `${defaultOptions.baseURL}${config.url}`;\r\n  if (newConfig.url.indexOf('/user/login') == -1 && newConfig.url.indexOf('/user/register') == -1) {\r\n    const userId = localStorage.getItem('userId')\r\n    if (userId) {\r\n      config.params ? Object.assign(config.params, { 'userId': userId }) : config.params = { 'userId': userId }\r\n    }\r\n  }\r\n  if (config.params) {\r\n    if (config.method.toUpperCase() === 'GET') {\r\n      newConfig.url = `${newConfig.url}?${Object.keys(config.params).map(m => (`${m}=${config.params[m]}`)).join('&')}`\r\n    } else if (config.method.toUpperCase() === 'POST') {\r\n      newConfig.body = JSON.stringify(config.params)\r\n    }\r\n    delete newConfig.params\r\n  }\r\n  newConfig.url = newConfig.url.indexOf('?') > -1 ? `${newConfig.url}&code=${defaultOptions.code}` : `${newConfig.url}?code=${defaultOptions.code}`\r\n  return newConfig;\r\n};\r\n\r\nexport const request = async (url, options = {}) => {\r\n  const config = requestInterceptor({ ...defaultOptions, ...options, url });\r\n  const response = await fetch(config.url, { ...config });\r\n  if (response.ok) {\r\n    const data = await response.json();\r\n    if (data.result || data.code == 0) {\r\n      return Promise.resolve(data)\r\n    }\r\n    message.error(data.msg || 'error');\r\n    return Promise.reject();\r\n  }\r\n  return await errorHandler(response);\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}